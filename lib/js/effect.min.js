$.tools.validator.addEffect("depageEffect",function(a,b){$.each(a,function(a,b){var c=$(b.input).parents("p");c.find(".errorMessage").length===0&&(c.append('<span class="errorMessage">'+c.attr("data-errorMessage")+"</span>"),c.addClass("error"))})},function(a){$.each(a,function(a,b){var c=$(b).parents("p");c.removeClass("error"),c.find(".errorMessage").remove()})}),$(document).ready(function(){$(".depage-form").each(function(){var a=this,b=$(this),c=b.attr("data-jsvalidation"),d=b.attr("data-jsautosave");c=="blur"||c=="change"?b.validator({effect:"depageEffect",inputEvent:c,errorInputEvent:c}):c=="submit"&&b.validator({effect:"depageEffect",errorInputEvent:null}),b.bind("onFail",function(a,c){b.find(".submit").addClass("error")}),b.bind("onSuccess",function(a,c){var d=b.find(".errorMessage").length;d>0?b.find(".submit").addClass("error"):b.find(".submit").removeClass("error")});if(d=="true"){var e=1e3,f=new Date;a.data=a.data||{},a.data.saving=!1,a.data.lastsave=f.getTime(),a.data.timer=null,a.data.autosave=function(){var b={};$("input, select",a).each(function(){console.log("input: "+this.name+" = "+this.value),b[this.name]=this.value}),b["form-autosave"]="true",a.data.saving=!0,$.post(a.action,b,function(b,c){f=new Date,a.data.lastsave=f.getTime(),a.data.saving=!1,console.log("saved")})},a.data.changed=function(b){f=new Date,clearTimeout(a.data.timer),a.data.saving||(b||f.getTime()-a.data.lastsave>e?a.data.autosave():setTimeout(function(){a.data.changed()},e))},$("input, select",a).change(function(){a.data.changed(!0)})}$(".input-richtext",a).each(function(){var a=$(this).data("richtext-options"),b=$("textarea",this);b.depageEditor(a)})})})